trigger: none
schedules:
- cron: '0 1 * * *'
  displayName: 'Nightly build (UTC)'
  always: 'true'
  branches:
    include:
    - main

pool:
  name: 'Azure Pipelines'
  vmImage: ubuntu-latest

resources:
  repositories:
  - repository: modules
    type: git
    name: PipelineSamples/terraform-modules-sample

pool:
  name: 'Azure Pipelines'
  vmImage: $(vmImage)

steps:
- checkout: self

- checkout: modules
  fetchDepth: 1
  persistCredentials: true

- pwsh: |
    ls -alR ~/.gitconfig

    where .gitconfig   
    ~/.git-credentials


    terraform init
    terraform apply -auto-approve
  displayName: 'Terraform apply'
  workingDirectory: azure-pipeline-examples/deployment/terraform-modules