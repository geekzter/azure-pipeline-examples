trigger: none
schedules:
- cron: '0 1 * * *'
  displayName: 'Nightly build (UTC)'
  always: 'true'
  branches:
    include:
    - main


# container: ubuntu:20.04

jobs:
- job: stressTest
  displayName: 'stress-ng'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - script: |
      sudo apt-get install -y stress-ng
    displayName: 'Install stress-ng'
  - script: |
      # stress-ng --vm-bytes $(awk '/MemAvailable/{printf "%d\n", $2 * 0.9;}' < /proc/meminfo)k --vm-keep -m 1
      # stress-ng --vm-bytes $(awk '/MemAvailable/{printf "%d\n", $2 * 0.9;}' < /proc/meminfo)k --vm-keep -m 1 --aggressive --maximize
      stress-ng --matrix 0 --matrix-size 64 --tz  -t 60
      stress-ng --vm 2 --vm-bytes 2G --mmap 2 --mmap-bytes 2G --page-in
    displayName: 'Memory Test'
  - script: |
      stress-ng -c 0 -l 96 
      # stress-ng --cpu 8 --timeout 20
      # stress-ng --brk 2 --stack 2 --bigheap 2 --aggressive --maximize
    displayName: 'CPU Test'
    