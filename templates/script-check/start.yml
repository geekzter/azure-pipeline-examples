# File: start.yml
parameters:
- name: buildSteps # the name of the parameter is buildSteps
  type: stepList # data type is StepList
  default: [] # default value of buildSteps
stages:
- stage: secure_buildstage
  pool:
    vmImage: windows-latest
  jobs:
  - job: secure_buildjob
    steps:
    # - script: echo This happens before code 
    #   displayName: 'Base: Pre-build'
    # - script: echo Building
    #   displayName: 'Base: Build'

    - ${{ each step in parameters.buildSteps }}:
      - ${{ each pair in step }}:
          # ${{ if eq(pair.value, 'CmdLine@2' )}}:
          #   "Not allowed to use CmdLine@2": error
          # ${{ pair.key }}: ${{ pair.value }}
        #  - ${{ step }}
          # ${{ if ne(pair.key, 'bash') }}:
          ${{ if containsValue(pair.key, 'bash', 'pwsh', 'script', 'powershell') }}:
            "Not allowed to use script": error
          ${{ elseif startsWith(pair.value, 'Bash') }}:
            "Not allowed to use Bash": error
          ${{ elseif startsWith(pair.value, 'CmdLine') }}:
            "Not allowed to use BatchScript": error
          ${{ elseif startsWith(pair.value, 'PowerShell') }}:
            "Not allowed to use PowerShell": error
          ${{ elseif startsWith(pair.value, 'ShellScript') }}:
            "Not allowed to use ShellScript": error
          #   ${{ pair.key }}: ${{ pair.value }}
          # ${{ if eq(pair.value, 'CmdLine@2') }}:
          #   '${{ pair.value }}': # raises error: Unexpected value 'CmdLine@2'
          #   # 'CmdLine@2': # raises same error: Unexpected value 'CmdLine@2'
          #   # 'CmdLine@1': # raises similar error: Unexpected value 'CmdLine@1'
          #   # 'NonExistingTask@0': # raises similar error: Unexpected value 'NonExistingTask@0'
          #   "Not allowed to use CmdLine@1": ERROR          
          ${{ else }}:
            ${{ pair.key }}: ${{ pair.value }}
          # ${{ if ne(pair.value, 'CmdLine@2') }}:
            # ${{ pair.key }}: ${{ pair.value }}
          # ${{ if notIn(pair.key, 'projects', 'solution', 'arguments', 'msbuildArguments', 'displayNameSuffix', 'condition', 'skip') }}:
          #   ${{ pair.key }}: ${{ pair.value }}

    # - script: echo This happens after code
    #   displayName: 'Base: Signing'